{"version":3,"file":"save_response.min.js","sources":["../src/save_response.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Save response module for harpiasurvey.\n *\n * @module     mod_harpiasurvey/save_response\n * @copyright  2025 Your Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\nimport Config from 'core/config';\nimport $ from 'jquery';\n\nlet initialized = false;\nlet editLabel = 'Edit';\n\nconst lockQuestionItem = (questionItem) => {\n    questionItem.attr('data-response-locked', '1');\n    questionItem.removeAttr('data-response-editing');\n    questionItem.find('input, select, textarea').prop('disabled', true);\n};\n\nconst unlockQuestionItem = (questionItem) => {\n    questionItem.attr('data-response-locked', '0');\n    questionItem.attr('data-response-editing', '1');\n    questionItem.find('input, select, textarea').prop('disabled', false);\n};\n\nconst ensureEditButton = (questionItem) => {\n    let controls = questionItem.find('.question-edit-controls');\n    if (controls.length === 0) {\n        controls = $('<div class=\"mt-2 question-edit-controls\"></div>');\n        questionItem.append(controls);\n    }\n\n    let button = controls.find('.question-edit-btn');\n    if (button.length === 0) {\n        button = $('<button type=\"button\" class=\"btn btn-sm btn-outline-secondary question-edit-btn\"></button>');\n        controls.append(button);\n    }\n    button.text(editLabel);\n    button.show();\n};\n\nconst hideEditButton = (questionItem) => {\n    questionItem.find('.question-edit-btn').hide();\n};\n\nconst hasSavedMessage = (questionItem) => {\n    return questionItem.find('.saved-response-message').length > 0;\n};\n\nconst sanitizeNumericValue = (value) => {\n    if (value === null || value === undefined) {\n        return '';\n    }\n\n    let normalized = String(value).replace(',', '.');\n    normalized = normalized.replace(/[^0-9.\\-]/g, '');\n    normalized = normalized.replace(/(?!^)-/g, '');\n    normalized = normalized.replace(/(\\..*)\\./g, '$1');\n\n    return normalized;\n};\n\n/**\n * Get a human-readable response display for a question.\n *\n * @param {jQuery} questionItem Question container\n * @param {string} questionType Question type\n * @return {string} Display text\n */\nconst getResponseDisplay = (questionItem, questionType) => {\n    let display = '';\n\n    if (questionType === 'singlechoice' || questionType === 'likert') {\n        const checked = questionItem.find('input[type=\"radio\"]:checked');\n        if (checked.length > 0) {\n            const id = checked.attr('id');\n            const label = id ? questionItem.find(`label[for=\"${id}\"]`).text().trim() : '';\n            display = label || checked.val();\n        }\n    } else if (questionType === 'multiplechoice') {\n        const labels = [];\n        questionItem.find('input[type=\"checkbox\"]:checked').each(function() {\n            const id = $(this).attr('id');\n            const label = id ? questionItem.find(`label[for=\"${id}\"]`).text().trim() : '';\n            labels.push(label || $(this).val());\n        });\n        display = labels.join(', ');\n    } else if (questionType === 'select') {\n        const select = questionItem.find('select');\n        const selected = select.find('option:selected');\n        display = selected.length ? selected.text().trim() : '';\n    } else if (questionType === 'number') {\n        const input = questionItem.find('input[type=\"number\"]');\n        display = input.val();\n    } else if (questionType === 'shorttext') {\n        const input = questionItem.find('input[type=\"text\"]');\n        display = input.val();\n    } else if (questionType === 'longtext') {\n        const textarea = questionItem.find('textarea');\n        display = textarea.val();\n    }\n\n    if (!display) {\n        return '-';\n    }\n\n    return display;\n};\n\n/**\n * Initialize the save response functionality.\n *\n */\nexport const init = () => {\n    if (initialized) {\n        return;\n    }\n\n    getString('edit', 'moodle').then((str) => {\n        editLabel = str;\n    }).catch(() => {\n        editLabel = 'Edit';\n    });\n\n    // Pre-populate select dropdowns with saved values.\n    $('select[data-saved-value]').each(function() {\n        const select = $(this);\n        const savedValue = select.data('saved-value');\n        if (savedValue) {\n            select.val(savedValue);\n        }\n    });\n\n    // Lock already-saved questions on load.\n    $('.question-item').each(function() {\n        const questionItem = $(this);\n        if (hasSavedMessage(questionItem)) {\n            lockQuestionItem(questionItem);\n            ensureEditButton(questionItem);\n        }\n    });\n\n    // Enable editing for a previously saved question.\n    $(document).on('click', '.question-edit-btn', function(e) {\n        e.preventDefault();\n        const questionItem = $(this).closest('.question-item');\n        unlockQuestionItem(questionItem);\n        hideEditButton(questionItem);\n        const firstInput = questionItem.find('input, select, textarea').first();\n        if (firstInput.length > 0) {\n            firstInput.focus();\n        }\n    });\n\n    // Enforce numeric-only values for number questions (including dynamically rendered ones).\n    $(document).on('input', '.question-item[data-questiontype=\"number\"] input[type=\"number\"]', function() {\n        const input = $(this);\n        const sanitized = sanitizeNumericValue(input.val());\n        if (input.val() !== sanitized) {\n            input.val(sanitized);\n        }\n    });\n\n    // Handle save all button click.\n    $(document).on('click', '.save-all-responses-btn', function(e) {\n        e.preventDefault();\n        const button = $(this);\n        const cmid = parseInt(button.data('cmid'), 10);\n        const pageid = parseInt(button.data('pageid'), 10);\n        const container = button.closest('.page-questions');\n        const statusDiv = container.length ? container.find('.save-all-status') : $('.save-all-status');\n\n        // Collect all questions and their responses.\n        const questionsToSave = [];\n        const questionItems = container.length ? container.find('.question-item') : $('.question-item');\n        questionItems.each(function() {\n            const questionItem = $(this);\n\n            const questionid = parseInt(questionItem.data('questionid'), 10);\n            const questiontype = questionItem.data('questiontype');\n\n            if (!questionid || !questiontype) {\n                return; // Skip if we can't find question ID or type.\n            }\n\n            const isLocked = String(questionItem.attr('data-response-locked')) === '1';\n            const isEditing = String(questionItem.attr('data-response-editing')) === '1';\n            if (isLocked && !isEditing) {\n                return;\n            }\n\n            // Get the response value based on question type.\n            let response = '';\n\n            if (questiontype === 'singlechoice' || questiontype === 'likert') {\n                const selected = questionItem.find('input[type=\"radio\"]:checked');\n                if (selected.length > 0) {\n                    response = selected.val();\n                }\n            } else if (questiontype === 'multiplechoice') {\n                const selected = questionItem.find('input[type=\"checkbox\"]:checked');\n                const values = [];\n                selected.each(function() {\n                    values.push($(this).val());\n                });\n                if (values.length > 0) {\n                    response = JSON.stringify(values);\n                }\n            } else if (questiontype === 'select') {\n                const selected = questionItem.find('select').val();\n                if (selected) {\n                    response = selected;\n                }\n            } else if (questiontype === 'number' || questiontype === 'shorttext') {\n                const input = questionItem.find('input[type=\"number\"], input[type=\"text\"]');\n                const value = input.val();\n                if (value !== null && value !== undefined && String(value).trim() !== '') {\n                    response = value;\n                }\n            } else if (questiontype === 'longtext') {\n                const textarea = questionItem.find('textarea');\n                const value = textarea.val();\n                if (value !== null && value !== undefined && String(value).trim() !== '') {\n                    response = value;\n                }\n            }\n\n            // Skip unanswered questions entirely.\n            if (response === '' || response === null || response === undefined) {\n                return;\n            }\n\n            questionsToSave.push({\n                questionid: questionid,\n                questiontype: questiontype,\n                response: response,\n                questionItem: questionItem\n            });\n        });\n\n        if (questionsToSave.length === 0) {\n            Notification.addNotification({\n                message: 'No editable questions to save. Click Edit on a question first.',\n                type: 'info'\n            });\n            return;\n        }\n\n        // Save all responses sequentially.\n        saveAllResponses(cmid, pageid, questionsToSave, button, statusDiv);\n    });\n\n    initialized = true;\n};\n\n/**\n * Save all responses sequentially.\n *\n * @param {number} cmid Course module ID\n * @param {number} pageid Page ID\n * @param {Array} questionsToSave Array of {questionid, questiontype, response} objects\n * @param {jQuery} button Save button element\n * @param {jQuery} statusDiv Status div element\n */\nconst saveAllResponses = (cmid, pageid, questionsToSave, button, statusDiv) => {\n    const originalText = button.text();\n    button.prop('disabled', true);\n    statusDiv.show().html('<div class=\"text-info\"><i class=\"fa fa-spinner fa-spin\"></i> Saving responses...</div>');\n\n    // Check if this is a turns/continuous mode page and get current iteration.\n    // The button might be outside the ai-conversation-container, so search from document.\n    const container = $(\n        '.ai-conversation-container[data-pageid=\"' + pageid + '\"], ' +\n        '.multi-model-chat-container[data-pageid=\"' + pageid + '\"]'\n    ).first();\n    let turnId = null;\n    if (container.length > 0) {\n        const behavior = container.data('behavior');\n        if (behavior === 'turns') {\n            // Get current viewing turn from the container.\n            const viewingTurn = container.attr('data-viewing-turn');\n            if (viewingTurn) {\n                turnId = parseInt(viewingTurn, 10);\n            } else {\n                // If no viewing turn is set, get the current turn (highest turn with messages).\n                const messagesContainer = container.find(`#chat-messages-page-${pageid}`);\n                if (messagesContainer.length > 0) {\n                    const messages = messagesContainer.find('.message[data-turn-id]');\n                    let maxTurn = 0;\n                    messages.each(function() {\n                        const msgTurnId = parseInt($(this).attr('data-turn-id'), 10);\n                        if (msgTurnId > maxTurn) {\n                            maxTurn = msgTurnId;\n                        }\n                    });\n                    if (maxTurn > 0) {\n                        turnId = maxTurn;\n                    } else {\n                        // If no messages yet, default to turn 1 (first turn).\n                        turnId = 1;\n                    }\n                } else {\n                    // If no messages container found, default to turn 1 (first turn).\n                    turnId = 1;\n                }\n            }\n        } else if (behavior === 'continuous') {\n            const viewingConversation = container.data('viewing-conversation') ||\n                parseInt(container.attr('data-viewing-conversation'), 10);\n            if (viewingConversation && !isNaN(viewingConversation)) {\n                turnId = parseInt(viewingConversation, 10);\n            }\n        } else if (behavior === 'review_conversation') {\n            const reviewTargetId = parseInt(container.attr('data-review-target-id'), 10);\n            if (reviewTargetId && !isNaN(reviewTargetId)) {\n                turnId = reviewTargetId;\n            }\n        }\n    } else {\n        const reviewContainer = $(`.review-conversation-container[data-pageid=\"${pageid}\"]`);\n        if (reviewContainer.length) {\n            const reviewTargetId = parseInt(reviewContainer.attr('data-review-target-id'), 10);\n            if (reviewTargetId && !isNaN(reviewTargetId)) {\n                turnId = reviewTargetId;\n            }\n        }\n    }\n\n    let savedCount = 0;\n    let failedCount = 0;\n    const total = questionsToSave.length;\n\n    // Save responses sequentially using Promise chain.\n    let promiseChain = Promise.resolve();\n\n    questionsToSave.forEach((questionData, index) => {\n        promiseChain = promiseChain.then(() => {\n            return new Promise((resolve) => {\n                // Update status.\n                const savingHtml = '<div class=\"text-info\"><i class=\"fa fa-spinner fa-spin\"></i> ' +\n                    `Saving ${index + 1} of ${total}...` +\n                    '</div>';\n                statusDiv.html(savingHtml);\n\n                const params = new URLSearchParams({\n                    action: 'save_response',\n                    cmid: cmid,\n                    pageid: pageid,\n                    questionid: questionData.questionid,\n                    response: questionData.response,\n                    sesskey: Config.sesskey\n                });\n\n                // Add turn_id if this is a turns mode page.\n                if (turnId !== null && turnId > 0) {\n                    params.append('turn_id', turnId);\n                }\n\n                fetch(Config.wwwroot + '/mod/harpiasurvey/ajax.php?' + params.toString(), {\n                    method: 'GET',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                })\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success) {\n                        savedCount++;\n                        // Update saved message for this question.\n                        const now = new Date();\n                        const datetimeStr = now.toLocaleString();\n                        getString('saved', 'mod_harpiasurvey').then((savedText) => {\n                            getString('on', 'mod_harpiasurvey').then((onText) => {\n                                const questionItem = questionData.questionItem ? $(questionData.questionItem) :\n                                    $(`.question-item[data-questionid=\"${questionData.questionid}\"]`);\n                                const savedMessage = questionItem.find(`.saved-response-message[data-questionid=\"${questionData.questionid}\"]`);\n                                const icon = '<i class=\"fa fa-check-circle\" aria-hidden=\"true\"></i>';\n                                if (savedMessage.length === 0) {\n                                    // Create new message element.\n                                    const messageHtml = '<div class=\"mt-2 small text-muted saved-response-message\" ' +\n                                        `data-questionid=\"${questionData.questionid}\">` +\n                                        `${icon} ${savedText} ${onText} ${datetimeStr}</div>`;\n                                    questionItem.append(messageHtml);\n                                } else {\n                                    // Update existing message timestamp.\n                                    savedMessage.html(`${icon} ${savedText} ${onText} ${datetimeStr}`);\n                                }\n                                lockQuestionItem(questionItem);\n                                ensureEditButton(questionItem);\n\n                                // Update history timeline.\n                                getString('answerhistory', 'mod_harpiasurvey').then((historyText) => {\n                                    let history = questionItem.find(`.answer-history[data-questionid=\"${questionData.questionid}\"]`);\n                                    if (history.length === 0) {\n                                        const details = $('<details class=\"answer-history mt-1 d-none\"></details>');\n                                        details.attr('data-questionid', questionData.questionid);\n                                        details.append(`<summary>${historyText} (1)</summary>`);\n                                        details.append('<ul class=\"list-unstyled mt-2 mb-0\"></ul>');\n                                        questionItem.append(details);\n                                        history = details;\n                                    }\n                                    const list = history.find('ul');\n                                    const responseDisplay = getResponseDisplay(questionItem, questionData.questiontype);\n                                    list.prepend(`<li class=\"mb-1\"><span class=\"text-muted\">${datetimeStr}</span> â€” ${$('<div>').text(responseDisplay).html()}</li>`);\n\n                                    const count = list.find('li').length;\n                                    history.find('summary').text(`${historyText} (${count})`);\n                                    if (count > 1) {\n                                        history.removeClass('d-none');\n                                    }\n                                });\n                            });\n                        });\n                    } else {\n                        failedCount++;\n                    }\n                    resolve();\n                })\n                .catch(() => {\n                    failedCount++;\n                    resolve(); // Continue with next question even on error.\n                });\n            });\n        });\n    });\n\n    // After all saves complete.\n    promiseChain.then(() => {\n        button.prop('disabled', false);\n        button.text(originalText);\n\n        if (failedCount === 0) {\n            // All saved successfully.\n            button.removeClass('btn-primary').addClass('btn-success');\n            const successHtml = '<div class=\"text-success\"><i class=\"fa fa-check-circle\"></i> ' +\n                `All ${savedCount} response(s) saved successfully!</div>`;\n            statusDiv.html(successHtml);\n            setTimeout(() => {\n                button.removeClass('btn-success').addClass('btn-primary');\n                statusDiv.fadeOut();\n            }, 3000);\n        } else {\n            // Some failed.\n            button.removeClass('btn-primary').addClass('btn-warning');\n            const warningHtml = '<div class=\"text-warning\"><i class=\"fa fa-exclamation-triangle\"></i> ' +\n                `${savedCount} saved, ${failedCount} failed. Please try again.</div>`;\n            statusDiv.html(warningHtml);\n            setTimeout(() => {\n                button.removeClass('btn-warning').addClass('btn-primary');\n            }, 5000);\n        }\n    });\n};\n"],"names":["initialized","editLabel","lockQuestionItem","questionItem","attr","removeAttr","find","prop","ensureEditButton","controls","length","append","button","text","show","getResponseDisplay","questionType","display","checked","id","trim","val","labels","each","this","label","push","join","selected","then","str","catch","select","savedValue","data","hasSavedMessage","document","on","e","preventDefault","closest","unlockQuestionItem","hide","hideEditButton","firstInput","first","focus","input","sanitized","value","normalized","String","replace","sanitizeNumericValue","cmid","parseInt","pageid","container","statusDiv","questionsToSave","questionid","questiontype","isLocked","isEditing","response","values","JSON","stringify","saveAllResponses","addNotification","message","type","originalText","html","turnId","behavior","viewingTurn","messagesContainer","messages","maxTurn","msgTurnId","viewingConversation","isNaN","reviewTargetId","reviewContainer","savedCount","failedCount","total","promiseChain","Promise","resolve","forEach","questionData","index","savingHtml","params","URLSearchParams","action","sesskey","Config","fetch","wwwroot","toString","method","headers","json","success","datetimeStr","Date","toLocaleString","savedText","onText","savedMessage","icon","messageHtml","historyText","history","details","list","responseDisplay","prepend","count","removeClass","addClass","successHtml","setTimeout","fadeOut","warningHtml"],"mappings":"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"}