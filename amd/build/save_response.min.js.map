{"version":3,"file":"save_response.min.js","sources":["../src/save_response.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Save response module for harpiasurvey.\n *\n * @module     mod_harpiasurvey/save_response\n * @copyright  2025 Your Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\nimport Config from 'core/config';\nimport $ from 'jquery';\n\nlet initialized = false;\nlet editLabel = 'Edit';\n\nconst lockQuestionItem = (questionItem) => {\n    questionItem.attr('data-response-locked', '1');\n    questionItem.removeAttr('data-response-editing');\n    questionItem.find('input, select, textarea').prop('disabled', true);\n};\n\nconst unlockQuestionItem = (questionItem) => {\n    questionItem.attr('data-response-locked', '0');\n    questionItem.attr('data-response-editing', '1');\n    questionItem.find('input, select, textarea').prop('disabled', false);\n};\n\nconst ensureEditButton = (questionItem) => {\n    let controls = questionItem.find('.question-edit-controls');\n    if (controls.length === 0) {\n        controls = $('<div class=\"mt-2 question-edit-controls\"></div>');\n        questionItem.append(controls);\n    }\n\n    let button = controls.find('.question-edit-btn');\n    if (button.length === 0) {\n        button = $('<button type=\"button\" class=\"btn btn-sm btn-outline-secondary question-edit-btn\"></button>');\n        controls.append(button);\n    }\n    button.text(editLabel);\n    button.show();\n};\n\nconst hideEditButton = (questionItem) => {\n    questionItem.find('.question-edit-btn').hide();\n};\n\nconst hasSavedMessage = (questionItem) => {\n    return questionItem.find('.saved-response-message').length > 0;\n};\n\n/**\n * Get a human-readable response display for a question.\n *\n * @param {jQuery} questionItem Question container\n * @param {string} questionType Question type\n * @return {string} Display text\n */\nconst getResponseDisplay = (questionItem, questionType) => {\n    let display = '';\n\n    if (questionType === 'singlechoice' || questionType === 'likert') {\n        const checked = questionItem.find('input[type=\"radio\"]:checked');\n        if (checked.length > 0) {\n            const id = checked.attr('id');\n            const label = id ? questionItem.find(`label[for=\"${id}\"]`).text().trim() : '';\n            display = label || checked.val();\n        }\n    } else if (questionType === 'multiplechoice') {\n        const labels = [];\n        questionItem.find('input[type=\"checkbox\"]:checked').each(function() {\n            const id = $(this).attr('id');\n            const label = id ? questionItem.find(`label[for=\"${id}\"]`).text().trim() : '';\n            labels.push(label || $(this).val());\n        });\n        display = labels.join(', ');\n    } else if (questionType === 'select') {\n        const select = questionItem.find('select');\n        const selected = select.find('option:selected');\n        display = selected.length ? selected.text().trim() : '';\n    } else if (questionType === 'number') {\n        const input = questionItem.find('input[type=\"number\"]');\n        display = input.val();\n    } else if (questionType === 'shorttext') {\n        const input = questionItem.find('input[type=\"text\"]');\n        display = input.val();\n    } else if (questionType === 'longtext') {\n        const textarea = questionItem.find('textarea');\n        display = textarea.val();\n    }\n\n    if (!display) {\n        return '-';\n    }\n\n    return display;\n};\n\n/**\n * Initialize the save response functionality.\n *\n */\nexport const init = () => {\n    if (initialized) {\n        return;\n    }\n\n    getString('edit', 'moodle').then((str) => {\n        editLabel = str;\n    }).catch(() => {\n        editLabel = 'Edit';\n    });\n\n    // Pre-populate select dropdowns with saved values.\n    $('select[data-saved-value]').each(function() {\n        const select = $(this);\n        const savedValue = select.data('saved-value');\n        if (savedValue) {\n            select.val(savedValue);\n        }\n    });\n\n    // Lock already-saved questions on load.\n    $('.question-item').each(function() {\n        const questionItem = $(this);\n        if (hasSavedMessage(questionItem)) {\n            lockQuestionItem(questionItem);\n            ensureEditButton(questionItem);\n        }\n    });\n\n    // Enable editing for a previously saved question.\n    $(document).on('click', '.question-edit-btn', function(e) {\n        e.preventDefault();\n        const questionItem = $(this).closest('.question-item');\n        unlockQuestionItem(questionItem);\n        hideEditButton(questionItem);\n        const firstInput = questionItem.find('input, select, textarea').first();\n        if (firstInput.length > 0) {\n            firstInput.focus();\n        }\n    });\n\n    // Handle save all button click.\n    $(document).on('click', '.save-all-responses-btn', function(e) {\n        e.preventDefault();\n        const button = $(this);\n        const cmid = parseInt(button.data('cmid'), 10);\n        const pageid = parseInt(button.data('pageid'), 10);\n        const container = button.closest('.page-questions');\n        const statusDiv = container.length ? container.find('.save-all-status') : $('.save-all-status');\n\n        // Collect all questions and their responses.\n        const questionsToSave = [];\n        const questionItems = container.length ? container.find('.question-item') : $('.question-item');\n        questionItems.each(function() {\n            const questionItem = $(this);\n\n            const questionid = parseInt(questionItem.data('questionid'), 10);\n            const questiontype = questionItem.data('questiontype');\n\n            if (!questionid || !questiontype) {\n                return; // Skip if we can't find question ID or type.\n            }\n\n            const isLocked = String(questionItem.attr('data-response-locked')) === '1';\n            const isEditing = String(questionItem.attr('data-response-editing')) === '1';\n            if (isLocked && !isEditing) {\n                return;\n            }\n\n            // Get the response value based on question type.\n            let response = '';\n\n            if (questiontype === 'singlechoice' || questiontype === 'likert') {\n                const selected = questionItem.find('input[type=\"radio\"]:checked');\n                if (selected.length > 0) {\n                    response = selected.val();\n                }\n            } else if (questiontype === 'multiplechoice') {\n                const selected = questionItem.find('input[type=\"checkbox\"]:checked');\n                const values = [];\n                selected.each(function() {\n                    values.push($(this).val());\n                });\n                response = JSON.stringify(values);\n            } else if (questiontype === 'select') {\n                const selected = questionItem.find('select').val();\n                if (selected) {\n                    response = selected;\n                }\n            } else if (questiontype === 'number' || questiontype === 'shorttext') {\n                const input = questionItem.find('input[type=\"number\"], input[type=\"text\"]');\n                response = input.val();\n            } else if (questiontype === 'longtext') {\n                const textarea = questionItem.find('textarea');\n                response = textarea.val();\n            }\n\n            questionsToSave.push({\n                questionid: questionid,\n                questiontype: questiontype,\n                response: response,\n                questionItem: questionItem\n            });\n        });\n\n        if (questionsToSave.length === 0) {\n            Notification.addNotification({\n                message: 'No editable questions to save. Click Edit on a question first.',\n                type: 'info'\n            });\n            return;\n        }\n\n        // Save all responses sequentially.\n        saveAllResponses(cmid, pageid, questionsToSave, button, statusDiv);\n    });\n\n    initialized = true;\n};\n\n/**\n * Save all responses sequentially.\n *\n * @param {number} cmid Course module ID\n * @param {number} pageid Page ID\n * @param {Array} questionsToSave Array of {questionid, questiontype, response} objects\n * @param {jQuery} button Save button element\n * @param {jQuery} statusDiv Status div element\n */\nconst saveAllResponses = (cmid, pageid, questionsToSave, button, statusDiv) => {\n    const originalText = button.text();\n    button.prop('disabled', true);\n    statusDiv.show().html('<div class=\"text-info\"><i class=\"fa fa-spinner fa-spin\"></i> Saving responses...</div>');\n\n    // Check if this is a turns/continuous mode page and get current iteration.\n    // The button might be outside the ai-conversation-container, so search from document.\n    const container = $('.ai-conversation-container[data-pageid=\"' + pageid + '\"]');\n    let turnId = null;\n    if (container.length > 0) {\n        const behavior = container.data('behavior');\n        if (behavior === 'turns') {\n            // Get current viewing turn from the container.\n            const viewingTurn = container.attr('data-viewing-turn');\n            if (viewingTurn) {\n                turnId = parseInt(viewingTurn, 10);\n            } else {\n                // If no viewing turn is set, get the current turn (highest turn with messages).\n                const messagesContainer = container.find(`#chat-messages-page-${pageid}`);\n                if (messagesContainer.length > 0) {\n                    const messages = messagesContainer.find('.message[data-turn-id]');\n                    let maxTurn = 0;\n                    messages.each(function() {\n                        const msgTurnId = parseInt($(this).attr('data-turn-id'), 10);\n                        if (msgTurnId > maxTurn) {\n                            maxTurn = msgTurnId;\n                        }\n                    });\n                    if (maxTurn > 0) {\n                        turnId = maxTurn;\n                    } else {\n                        // If no messages yet, default to turn 1 (first turn).\n                        turnId = 1;\n                    }\n                } else {\n                    // If no messages container found, default to turn 1 (first turn).\n                    turnId = 1;\n                }\n            }\n        } else if (behavior === 'continuous') {\n            const viewingConversation = container.data('viewing-conversation') ||\n                parseInt(container.attr('data-viewing-conversation'), 10);\n            if (viewingConversation && !isNaN(viewingConversation)) {\n                turnId = parseInt(viewingConversation, 10);\n            }\n        }\n    }\n\n    let savedCount = 0;\n    let failedCount = 0;\n    const total = questionsToSave.length;\n\n    // Save responses sequentially using Promise chain.\n    let promiseChain = Promise.resolve();\n\n    questionsToSave.forEach((questionData, index) => {\n        promiseChain = promiseChain.then(() => {\n            return new Promise((resolve) => {\n                // Update status.\n                const savingHtml = '<div class=\"text-info\"><i class=\"fa fa-spinner fa-spin\"></i> ' +\n                    `Saving ${index + 1} of ${total}...` +\n                    '</div>';\n                statusDiv.html(savingHtml);\n\n                const params = new URLSearchParams({\n                    action: 'save_response',\n                    cmid: cmid,\n                    pageid: pageid,\n                    questionid: questionData.questionid,\n                    response: questionData.response,\n                    sesskey: Config.sesskey\n                });\n\n                // Add turn_id if this is a turns mode page.\n                if (turnId !== null && turnId > 0) {\n                    params.append('turn_id', turnId);\n                }\n\n                fetch(Config.wwwroot + '/mod/harpiasurvey/ajax.php?' + params.toString(), {\n                    method: 'GET',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                })\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success) {\n                        savedCount++;\n                        // Update saved message for this question.\n                        const now = new Date();\n                        const datetimeStr = now.toLocaleString();\n                        getString('saved', 'mod_harpiasurvey').then((savedText) => {\n                            getString('on', 'mod_harpiasurvey').then((onText) => {\n                                const questionItem = questionData.questionItem ? $(questionData.questionItem) :\n                                    $(`.question-item[data-questionid=\"${questionData.questionid}\"]`);\n                                const savedMessage = questionItem.find(`.saved-response-message[data-questionid=\"${questionData.questionid}\"]`);\n                                const icon = '<i class=\"fa fa-check-circle\" aria-hidden=\"true\"></i>';\n                                if (savedMessage.length === 0) {\n                                    // Create new message element.\n                                    const messageHtml = '<div class=\"mt-2 small text-muted saved-response-message\" ' +\n                                        `data-questionid=\"${questionData.questionid}\">` +\n                                        `${icon} ${savedText} ${onText} ${datetimeStr}</div>`;\n                                    questionItem.append(messageHtml);\n                                } else {\n                                    // Update existing message timestamp.\n                                    savedMessage.html(`${icon} ${savedText} ${onText} ${datetimeStr}`);\n                                }\n                                lockQuestionItem(questionItem);\n                                ensureEditButton(questionItem);\n\n                                // Update history timeline.\n                                getString('answerhistory', 'mod_harpiasurvey').then((historyText) => {\n                                    let history = questionItem.find(`.answer-history[data-questionid=\"${questionData.questionid}\"]`);\n                                    if (history.length === 0) {\n                                        const details = $('<details class=\"answer-history mt-1 d-none\"></details>');\n                                        details.attr('data-questionid', questionData.questionid);\n                                        details.append(`<summary>${historyText} (1)</summary>`);\n                                        details.append('<ul class=\"list-unstyled mt-2 mb-0\"></ul>');\n                                        questionItem.append(details);\n                                        history = details;\n                                    }\n                                    const list = history.find('ul');\n                                    const responseDisplay = getResponseDisplay(questionItem, questionData.questiontype);\n                                    list.prepend(`<li class=\"mb-1\"><span class=\"text-muted\">${datetimeStr}</span> â€” ${$('<div>').text(responseDisplay).html()}</li>`);\n\n                                    const count = list.find('li').length;\n                                    history.find('summary').text(`${historyText} (${count})`);\n                                    if (count > 1) {\n                                        history.removeClass('d-none');\n                                    }\n                                });\n                            });\n                        });\n                    } else {\n                        failedCount++;\n                    }\n                    resolve();\n                })\n                .catch(() => {\n                    failedCount++;\n                    resolve(); // Continue with next question even on error.\n                });\n            });\n        });\n    });\n\n    // After all saves complete.\n    promiseChain.then(() => {\n        button.prop('disabled', false);\n        button.text(originalText);\n\n        if (failedCount === 0) {\n            // All saved successfully.\n            button.removeClass('btn-primary').addClass('btn-success');\n            const successHtml = '<div class=\"text-success\"><i class=\"fa fa-check-circle\"></i> ' +\n                `All ${savedCount} response(s) saved successfully!</div>`;\n            statusDiv.html(successHtml);\n            setTimeout(() => {\n                button.removeClass('btn-success').addClass('btn-primary');\n                statusDiv.fadeOut();\n            }, 3000);\n        } else {\n            // Some failed.\n            button.removeClass('btn-primary').addClass('btn-warning');\n            const warningHtml = '<div class=\"text-warning\"><i class=\"fa fa-exclamation-triangle\"></i> ' +\n                `${savedCount} saved, ${failedCount} failed. Please try again.</div>`;\n            statusDiv.html(warningHtml);\n            setTimeout(() => {\n                button.removeClass('btn-warning').addClass('btn-primary');\n            }, 5000);\n        }\n    });\n};\n"],"names":["initialized","editLabel","lockQuestionItem","questionItem","attr","removeAttr","find","prop","ensureEditButton","controls","length","append","button","text","show","getResponseDisplay","questionType","display","checked","id","trim","val","labels","each","this","label","push","join","selected","then","str","catch","select","savedValue","data","hasSavedMessage","document","on","e","preventDefault","closest","unlockQuestionItem","hide","hideEditButton","firstInput","first","focus","cmid","parseInt","pageid","container","statusDiv","questionsToSave","questionid","questiontype","isLocked","String","isEditing","response","values","JSON","stringify","saveAllResponses","addNotification","message","type","originalText","html","turnId","behavior","viewingTurn","messagesContainer","messages","maxTurn","msgTurnId","viewingConversation","isNaN","savedCount","failedCount","total","promiseChain","Promise","resolve","forEach","questionData","index","savingHtml","params","URLSearchParams","action","sesskey","Config","fetch","wwwroot","toString","method","headers","json","success","datetimeStr","Date","toLocaleString","savedText","onText","savedMessage","icon","messageHtml","historyText","history","details","list","responseDisplay","prepend","count","removeClass","addClass","successHtml","setTimeout","fadeOut","warningHtml"],"mappings":"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"}