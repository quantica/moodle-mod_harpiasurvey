define("mod_harpiasurvey/question_bank_modal",["exports","core/modal","core/modal_events","core/notification","core/str","core/templates","core/config","jquery"],(function(_exports,_modal,_modal_events,_notification,_str,_templates,_config,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Question bank modal module.
   *
   * @module     mod_harpiasurvey/question_bank_modal
   * @copyright  2025 Your Name
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showSubpageModal=_exports.showModal=_exports.init=void 0,_modal=_interopRequireDefault(_modal),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_config=_interopRequireDefault(_config),_jquery=_interopRequireDefault(_jquery);let modalInstance=null,initialized=!1,editingMode=!1;_exports.init=(cmid,pageid,editingmode)=>{initialized||(editingMode=!!editingmode,(0,_jquery.default)("body").on("click",".question-bank-modal-trigger",(function(e){e.preventDefault();const button=(0,_jquery.default)(this),triggerCmid=parseInt(button.data("cmid"),10),triggerPageid=parseInt(button.data("pageid"),10);showModal(triggerCmid||cmid,triggerPageid||pageid)})),(0,_jquery.default)("body").on("click",".subpage-question-bank-modal-trigger",(function(e){e.preventDefault();const button=(0,_jquery.default)(this),triggerCmid=parseInt(button.data("cmid"),10),triggerPageid=parseInt(button.data("pageid"),10),triggerSubpageid=parseInt(button.data("subpageid"),10);showSubpageModal(triggerCmid||cmid,triggerPageid||pageid,triggerSubpageid)})),initialized=!0)};const showModal=(cmid,pageid)=>modalInstance?(modalInstance.show(),loadQuestions(cmid,pageid),Promise.resolve()):(0,_str.get_string)("questionbank","mod_harpiasurvey").then((title=>_modal.default.create({title:title,body:_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{loading:!0,editingmode:editingMode}),large:!0,show:!0}))).then((modal=>(modalInstance=modal,modal.getRoot().on(_modal_events.default.shown,(()=>{loadQuestions(cmid,pageid)})),modal.getRoot().on("click",'[data-action="add-question"]',(e=>{e.preventDefault();const questionId=parseInt(e.currentTarget.dataset.questionid,10);addQuestionToPage(cmid,pageid,questionId)})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.setBody(_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{loading:!0,editingmode:editingMode}))})),modal))).catch(_notification.default.exception);_exports.showModal=showModal;const loadQuestions=(cmid,pageid)=>{const bodyPromise=modalInstance.getBodyPromise(),ajaxUrl=_config.default.wwwroot+"/mod/harpiasurvey/ajax.php",params=new URLSearchParams({action:"get_available_questions",cmid:cmid,pageid:pageid});fetch(ajaxUrl+"?"+params.toString()).then((response=>response.json())).then((response=>response.success?_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{questions:response.questions,has_questions:response.questions.length>0,is_aichat_page:response.is_aichat_page||!1,cmid:cmid,pageid:pageid,editingmode:editingMode}):_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{error:response.message||"Error loading questions",has_questions:!1,editingmode:editingMode}))).then((html=>bodyPromise.then((()=>{modalInstance.setBody(html)})))).catch((error=>bodyPromise.then((()=>{modalInstance.setBody(_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{error:"Error loading questions",has_questions:!1,editingmode:editingMode}))}))))},addQuestionToPage=(cmid,pageid,questionId)=>{const wwwroot=_config.default.wwwroot,sesskey=_config.default.sesskey||M.cfg.sesskey,ajaxUrl=wwwroot+"/mod/harpiasurvey/ajax.php",params=new URLSearchParams({action:"add_question_to_page",cmid:cmid,pageid:pageid,questionid:questionId,sesskey:sesskey});fetch(ajaxUrl+"?"+params.toString()).then((response=>response.json())).then((response=>{response.success?(_notification.default.addNotification({message:response.message,type:"success"}),window.location.reload()):_notification.default.addNotification({message:response.message||"Error adding question",type:"error"})})).catch(_notification.default.exception)};let subpageModalInstance=null;const showSubpageModal=(cmid,pageid,subpageid)=>subpageModalInstance?(subpageModalInstance.show(),loadSubpageQuestions(cmid,pageid,subpageid),Promise.resolve()):(0,_str.get_string)("addquestiontosubpage","mod_harpiasurvey").then((title=>_modal.default.create({title:title,body:_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{loading:!0,editingmode:editingMode}),large:!0,show:!0}))).then((modal=>(subpageModalInstance=modal,modal.getRoot().on(_modal_events.default.shown,(()=>{loadSubpageQuestions(cmid,pageid,subpageid)})),modal.getRoot().on("click",'[data-action="add-question-to-subpage"]',(e=>{e.preventDefault();const questionId=parseInt(e.currentTarget.dataset.questionid,10);addQuestionToSubpage(cmid,pageid,subpageid,questionId)})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.setBody(_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{loading:!0,editingmode:editingMode}))})),modal))).catch(_notification.default.exception);_exports.showSubpageModal=showSubpageModal;const loadSubpageQuestions=(cmid,pageid,subpageid)=>{const bodyPromise=subpageModalInstance.getBodyPromise(),ajaxUrl=_config.default.wwwroot+"/mod/harpiasurvey/ajax.php",params=new URLSearchParams({action:"get_available_subpage_questions",cmid:cmid,pageid:pageid,subpageid:subpageid});fetch(ajaxUrl+"?"+params.toString()).then((response=>response.json())).then((response=>response.success?_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{questions:response.questions,has_questions:response.questions.length>0,is_aichat_page:!1,cmid:cmid,pageid:pageid,subpageid:subpageid,is_subpage:!0,editingmode:editingMode}):_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{error:response.message||"Error loading questions",has_questions:!1,editingmode:editingMode}))).then((html=>bodyPromise.then((()=>{subpageModalInstance.setBody(html)})))).catch((error=>bodyPromise.then((()=>{subpageModalInstance.setBody(_templates.default.render("mod_harpiasurvey/question_bank_modal_body",{error:"Error loading questions",has_questions:!1,editingmode:editingMode}))}))))},addQuestionToSubpage=(cmid,pageid,subpageid,questionId)=>{const wwwroot=_config.default.wwwroot,sesskey=_config.default.sesskey||M.cfg.sesskey,ajaxUrl=wwwroot+"/mod/harpiasurvey/ajax.php",params=new URLSearchParams({action:"add_question_to_subpage",cmid:cmid,pageid:pageid,subpageid:subpageid,questionid:questionId,sesskey:sesskey});fetch(ajaxUrl+"?"+params.toString()).then((response=>response.json())).then((response=>{response.success?(_notification.default.addNotification({message:response.message,type:"success"}),window.location.reload()):_notification.default.addNotification({message:response.message||"Error adding question",type:"error"})})).catch(_notification.default.exception)}}));

//# sourceMappingURL=question_bank_modal.min.js.map