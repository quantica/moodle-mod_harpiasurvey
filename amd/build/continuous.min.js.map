{"version":3,"file":"continuous.min.js","sources":["../src/continuous.js"],"sourcesContent":["// Continuous-only logic for harpiasurvey chat.\nimport {\n    Templates,\n    Notification,\n    Config,\n    $,\n    conversationTrees,\n    scrollToBottom,\n    addError,\n    getCmid\n} from './common_chat';\n\nlet initialized = false;\nlet commonHandlersRegistered = false;\nlet treeHandlersRegistered = false;\n\nexport const init = () => initialize();\n\n/**\n * Initialize continuous-mode chat containers.\n */\nconst initialize = () => {\n    if (initialized) {\n        return;\n    }\n    const containers = $('.ai-conversation-container[data-behavior=\"continuous\"]');\n    if (containers.length === 0) {\n        return;\n    }\n    containers.each(function() {\n        const pageid = parseInt($(this).data('pageid'), 10);\n        if (!pageid) {\n            return;\n        }\n        initContinuousPage(pageid);\n    });\n    registerCommonHandlers();\n    registerTreeHandlers();\n    initialized = true;\n};\n\n/**\n * Initialize a specific continuous chat page.\n *\n * @param {number} pageid Page ID\n */\nconst initContinuousPage = (pageid) => {\n    const container = $(`.ai-conversation-container[data-pageid=\"${pageid}\"]`);\n    const messagesContainer = $(`#chat-messages-page-${pageid}`);\n    const allMessages = messagesContainer.find('.message');\n    if (allMessages.length > 0) {\n        const lastMessage = allMessages.last();\n        const lastMessageId = parseInt(lastMessage.data('messageid'), 10);\n        if (lastMessageId && !isNaN(lastMessageId)) {\n            let rootId = lastMessageId;\n            let currentId = lastMessageId;\n            let found = false;\n            const parentMap = new Map();\n            allMessages.each(function() {\n                const msgId = parseInt($(this).data('messageid'), 10);\n                const parentId = parseInt($(this).data('parentid'), 10);\n                if (msgId && !isNaN(msgId)) {\n                    parentMap.set(msgId, parentId && !isNaN(parentId) ? parentId : null);\n                }\n            });\n            while (currentId && !found) {\n                const parentId = parentMap.get(currentId);\n                if (!parentId) {\n                    rootId = currentId;\n                    found = true;\n                } else {\n                    currentId = parentId;\n                }\n            }\n            if (found) {\n                container.data('viewing-conversation', rootId);\n                container.attr('data-viewing-conversation', rootId);\n                filterMessagesByConversation(pageid, rootId);\n            }\n        }\n    }\n    const sidebar = $(`#conversation-tree-sidebar-${pageid}`);\n    if (sidebar.length > 0) {\n        sidebar.show();\n        loadConversationTree(pageid);\n    }\n};\n\nfunction registerCommonHandlers() {\n    if (commonHandlersRegistered) {\n        return;\n    }\n    $(document).on('click', '.chat-send-btn', function(e) {\n        e.preventDefault();\n        const button = $(this);\n        const cmid = parseInt(button.data('cmid'), 10);\n        const pageid = parseInt(button.data('pageid'), 10);\n        if (!cmid || !pageid) {\n            addError('Missing cmid or pageid');\n            return;\n        }\n        const input = $(`#chat-input-page-${pageid}`);\n        if (input.length === 0) {\n            addError('Chat input not found');\n            return;\n        }\n        const inputValue = input.val();\n        if (!inputValue) {\n            return;\n        }\n        const message = inputValue.trim();\n        if (!message) {\n            return;\n        }\n        const container = button.closest('.ai-conversation-container');\n        const modelsdata = container.data('models');\n        let modelid = null;\n        if (modelsdata) {\n            const modelids = modelsdata.split(',');\n            if (modelids.length > 0) {\n                modelid = parseInt(modelids[0], 10);\n            }\n        }\n        if (!modelid) {\n            addError('No model available');\n            return;\n        }\n        input.prop('disabled', true);\n        button.prop('disabled', true);\n        input.val('');\n        const tempId = 'temp-user-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);\n        displayUserMessage(pageid, message, tempId);\n        const loading = $(`#chat-loading-page-${pageid}`);\n        loading.show();\n        sendMessage(cmid, pageid, message, modelid, button, input, loading);\n    });\n\n    $(document).on('keydown', '.chat-input', function(e) {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            $(this).closest('.ai-conversation-container').find('.chat-send-btn').click();\n        }\n    });\n\n    commonHandlersRegistered = true;\n}\n\nfunction registerTreeHandlers() {\n    if (treeHandlersRegistered) {\n        return;\n    }\n    $(document).on('click', '.tree-node-content[data-action=\"navigate\"]', function(e) {\n        e.preventDefault();\n        const node = $(this);\n        const conversationId = parseInt(node.data('conversation-id'), 10);\n        const pageid = node.closest('.conversation-tree-sidebar').attr('id').replace('conversation-tree-sidebar-', '');\n        if (!pageid) {\n            return;\n        }\n        navigateToConversation(parseInt(pageid, 10), conversationId);\n    });\n\n    $(document).on('click', '.conversation-item', function(e) {\n        e.preventDefault();\n        const item = $(this);\n        const conversationId = parseInt(item.data('conversation-id'), 10);\n        const sidebarId = item.closest('.conversation-tree-sidebar').attr('id');\n        const pageid = parseInt(sidebarId.replace('conversation-tree-sidebar-', ''), 10);\n        if (!pageid) {\n            return;\n        }\n        navigateToConversation(pageid, conversationId);\n    });\n\n    $(document).on('click', '.create-root-btn', function(e) {\n        e.preventDefault();\n        const button = $(this);\n        const pageid = parseInt(button.data('pageid'), 10);\n        const cmid = parseInt(button.data('cmid'), 10);\n        if (!pageid || !cmid) {\n            addError('Missing required data to create root');\n            return;\n        }\n        createNewRoot(cmid, pageid);\n    });\n    \n    // Handle export conversation button clicks.\n    $(document).on('click', '.export-conversation-btn', function(e) {\n        e.preventDefault();\n        const button = $(this);\n        const pageid = parseInt(button.data('pageid'), 10);\n        const cmid = parseInt(button.data('cmid'), 10);\n        if (!pageid || !cmid) {\n            addError('Missing required data to export conversation');\n            return;\n        }\n        \n        // Get current viewing conversation\n        const container = $(`.ai-conversation-container[data-pageid=\"${pageid}\"]`);\n        const conversationId = container.data('viewing-conversation') || \n                                parseInt(container.attr('data-viewing-conversation'), 10);\n        \n        // Build export URL\n        const params = new URLSearchParams();\n        params.append('action', 'export_conversation');\n        params.append('cmid', cmid);\n        params.append('pageid', pageid);\n        params.append('sesskey', Config.sesskey);\n        \n        if (conversationId) {\n            params.append('conversation_id', conversationId);\n        }\n        \n        // Open export URL in new window/tab to trigger download\n        window.open(Config.wwwroot + '/mod/harpiasurvey/ajax.php?' + params.toString(), '_blank');\n    });\n\n    treeHandlersRegistered = true;\n}\n\nconst filterMessagesByConversation = (pageid, conversationId) => {\n    const messagesContainer = $(`#chat-messages-page-${pageid}`);\n    const conversationMessageIds = new Set();\n    conversationMessageIds.add(conversationId);\n    const messageParentMap = new Map();\n    \n    // Build parent map for ALL messages, including root messages (parentId = null)\n    messagesContainer.find('.message').each(function() {\n        const messageId = parseInt($(this).data('messageid'), 10);\n        const parentId = parseInt($(this).data('parentid'), 10);\n        if (messageId && !isNaN(messageId)) {\n            // Include all messages in the map, even if parentId is null/undefined\n            messageParentMap.set(messageId, (parentId && !isNaN(parentId)) ? parentId : null);\n        }\n    });\n    \n    // Traverse down from the root conversation ID to find all child messages\n    let changed = true;\n    while (changed) {\n        changed = false;\n        for (const [messageId, parentId] of messageParentMap.entries()) {\n            // If this message's parent is in the conversation, add this message\n            if (!conversationMessageIds.has(messageId) && parentId && conversationMessageIds.has(parentId)) {\n                conversationMessageIds.add(messageId);\n                changed = true;\n            }\n        }\n    }\n    \n    // Also ensure the root message itself is included (in case it wasn't found in traversal)\n    if (messageParentMap.has(conversationId)) {\n        conversationMessageIds.add(conversationId);\n    }\n    \n    // Show/hide messages based on conversation membership\n    let hasVisibleMessages = false;\n    messagesContainer.find('.message').each(function() {\n        const messageId = parseInt($(this).data('messageid'), 10);\n        if (conversationMessageIds.has(messageId)) {\n            $(this).show();\n            hasVisibleMessages = true;\n        } else {\n            $(this).hide();\n        }\n    });\n    \n    // Show placeholder if no messages are visible\n    const placeholder = messagesContainer.find('.text-center.text-muted');\n    if (!hasVisibleMessages) {\n        if (placeholder.length === 0) {\n            messagesContainer.prepend('<div class=\"text-center text-muted py-4\"><p>' +\n                'No messages yet. Send a message to start the conversation.</p></div>');\n        } else {\n            placeholder.show();\n        }\n    } else {\n        placeholder.hide();\n    }\n    \n    setTimeout(() => scrollToBottom(pageid), 50);\n};\n\nconst sendMessage = (cmid, pageid, message, modelid, button, input, loading) => {\n    const container = $(`#chat-messages-page-${pageid}`).closest('.ai-conversation-container');\n    const viewingConversation = container.data('viewing-conversation');\n    let parentid = null;\n    const messagesContainer = $(`#chat-messages-page-${pageid}`);\n    \n    if (viewingConversation) {\n        // Find the last message that belongs to this conversation\n        // Build parent map to find all messages in this conversation\n        const conversationMessageIds = new Set();\n        conversationMessageIds.add(viewingConversation);\n        const messageParentMap = new Map();\n        \n        // Build parent map for ALL messages\n        messagesContainer.find('.message').each(function() {\n            const messageId = parseInt($(this).data('messageid'), 10);\n            const parentId = parseInt($(this).data('parentid'), 10);\n            if (messageId && !isNaN(messageId)) {\n                messageParentMap.set(messageId, (parentId && !isNaN(parentId)) ? parentId : null);\n            }\n        });\n        \n        // Traverse down from root to find all messages in this conversation\n        let changed = true;\n        while (changed) {\n            changed = false;\n            for (const [messageId, parentId] of messageParentMap.entries()) {\n                if (!conversationMessageIds.has(messageId) && parentId && conversationMessageIds.has(parentId)) {\n                    conversationMessageIds.add(messageId);\n                    changed = true;\n                }\n            }\n        }\n        \n        // Find the last message in this conversation (by timecreated or order in DOM)\n        let lastMessageInConversation = null;\n        let lastTimeCreated = 0;\n        messagesContainer.find('.message').each(function() {\n            const messageId = parseInt($(this).data('messageid'), 10);\n            if (conversationMessageIds.has(messageId)) {\n                const timeCreated = parseInt($(this).data('timecreated'), 10) || 0;\n                if (timeCreated >= lastTimeCreated) {\n                    lastTimeCreated = timeCreated;\n                    lastMessageInConversation = $(this);\n                }\n            }\n        });\n        \n        if (lastMessageInConversation && lastMessageInConversation.length > 0) {\n            const lastMessageId = parseInt(lastMessageInConversation.data('messageid'), 10);\n            if (lastMessageId && !isNaN(lastMessageId)) {\n                parentid = lastMessageId;\n            }\n        } else {\n            // If no messages found in DOM, use the conversation root as parent\n            // This handles the case where a new conversation was just created and the placeholder isn't in the DOM yet\n            parentid = viewingConversation;\n        }\n    } else {\n        // No conversation selected - this shouldn't happen, but if it does, don't send a parentid\n        // The backend will create a new conversation\n        parentid = null;\n    }\n    const params = new URLSearchParams({\n        action: 'send_ai_message',\n        cmid: cmid,\n        pageid: pageid,\n        message: message,\n        modelid: modelid,\n        sesskey: Config.sesskey\n    });\n    // Always send parentid if we have one (even if it's the placeholder/conversation root)\n    // This ensures messages go to the correct conversation\n    if (parentid && !isNaN(parentid) && parentid > 0) {\n        params.append('parentid', parentid);\n    }\n    fetch(Config.wwwroot + '/mod/harpiasurvey/ajax.php?' + params.toString(), {\n        method: 'GET',\n        headers: {\n            'Content-Type': 'application/json'\n        }\n    })\n    .then(response => {\n        if (!response.ok) {\n            throw new Error('HTTP error! status: ' + response.status);\n        }\n        return response.json();\n    })\n    .then(data => {\n        loading.hide();\n        if (data.success) {\n            if (data.root_conversation_id) {\n                container.data('viewing-conversation', data.root_conversation_id);\n                container.attr('data-viewing-conversation', data.root_conversation_id);\n            }\n            if (data.messageid && data.content) {\n                displayAIMessage(pageid, data.content, data.messageid, data.turn_id).then(() => {\n                    loadConversationTree(pageid);\n                    setTimeout(() => {\n                        scrollToBottom(pageid);\n                    }, 100);\n                    input.prop('disabled', false);\n                    button.prop('disabled', false);\n                    input.focus();\n                });\n            } else {\n                addError('Received response but missing message ID or content');\n                input.prop('disabled', false);\n                button.prop('disabled', false);\n                input.focus();\n            }\n        } else {\n            addError(data.message || 'Error sending message');\n            input.prop('disabled', false);\n            button.prop('disabled', false);\n            input.focus();\n        }\n    })\n    .catch(error => {\n        loading.hide();\n        // eslint-disable-next-line no-console\n        console.error('Error sending message:', error);\n        addError('Error sending message: ' + error.message);\n        input.prop('disabled', false);\n        button.prop('disabled', false);\n        input.focus();\n    });\n};\n\nconst displayUserMessage = (pageid, message, messageid) => {\n    const messagesContainer = $(`#chat-messages-page-${pageid}`);\n    if (messagesContainer.length === 0) {\n        return;\n    }\n    messagesContainer.find('.text-center.text-muted').remove();\n    Templates.render('mod_harpiasurvey/chat_user_message', {\n        id: messageid,\n        content: message,\n        timecreated: Math.floor(Date.now() / 1000)\n    }).then((html) => {\n        messagesContainer.append(html);\n        scrollToBottom(pageid);\n    }).catch(Notification.exception);\n};\n\nconst displayAIMessage = (pageid, content, messageid) => {\n    const messagesContainer = $(`#chat-messages-page-${pageid}`);\n    if (messagesContainer.length === 0) {\n        return Promise.resolve();\n    }\n    return Templates.render('mod_harpiasurvey/chat_ai_message', {\n        id: messageid,\n        content: content,\n        timecreated: Math.floor(Date.now() / 1000)\n    }).then((html) => {\n        messagesContainer.append(html);\n        scrollToBottom(pageid);\n        return html;\n    }).catch(Notification.exception);\n};\n\n/**\n * Render simple conversation list in sidebar (for continuous mode, no fancytree).\n *\n * @param {number} pageid Page ID\n * @param {Array} roots Array of root conversations\n */\nconst renderConversationListSimple = (pageid, roots) => {\n    const treeContainer = $(`#conversation-tree-${pageid}`);\n    if (treeContainer.length === 0) {\n        return;\n    }\n    if (roots.length === 0) {\n        treeContainer.html('<div class=\"text-muted text-center small py-3\">' +\n            'No conversations yet. Click \"New conversation\" to start.</div>');\n        return;\n    }\n    \n    // Get the current viewing conversation\n    const container = $(`.ai-conversation-container[data-pageid=\"${pageid}\"]`);\n    const viewingConversation = container.data('viewing-conversation') || \n                                 parseInt(container.attr('data-viewing-conversation'), 10);\n    \n    let html = '<ul class=\"list-group list-group-flush\">';\n    roots.forEach((root) => {\n        const conversationNumber = root.conversation_number || '';\n        // Try multiple possible ID fields\n        const conversationId = root.id || root.conversation_id || root.turn_id;\n        const isActive = viewingConversation && parseInt(conversationId, 10) === parseInt(viewingConversation, 10);\n        const activeClass = isActive ? 'active' : '';\n        html += `<li class=\"list-group-item conversation-item ${activeClass}\" data-conversation-id=\"${conversationId}\" style=\"cursor: pointer;\">`;\n        html += `<div class=\"d-flex justify-content-between align-items-center\">`;\n        html += `<span class=\"font-weight-bold\">Conversation ${conversationNumber}</span>`;\n        html += `<small class=\"${isActive ? 'text-white-50' : 'text-muted'}\">${root.message_count || 0} messages</small>`;\n        html += `</div>`;\n        html += `</li>`;\n    });\n    html += '</ul>';\n    treeContainer.html(html);\n};\n\nconst loadConversationTree = (pageid) => {\n    const treeContainer = $(`#conversation-tree-${pageid}`);\n    const sidebar = $(`#conversation-tree-sidebar-${pageid}`);\n    if (treeContainer.length === 0) {\n        return Promise.resolve(null);\n    }\n    const cmid = getCmid(pageid);\n    if (!cmid) {\n        treeContainer.html('<div class=\"text-danger text-center small py-3\">' +\n            'Error: Course module ID not found. Please refresh the page.</div>');\n        return Promise.resolve(null);\n    }\n    const params = new URLSearchParams();\n    params.append('action', 'get_conversation_tree');\n    params.append('cmid', cmid);\n    params.append('pageid', pageid);\n    params.append('sesskey', Config.sesskey);\n    return fetch(Config.wwwroot + '/mod/harpiasurvey/ajax.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: params.toString()\n    })\n    .then((response) => {\n        if (!response.ok) {\n            throw new Error('HTTP error! status: ' + response.status);\n        }\n        return response.json();\n    })\n    .then((data) => {\n        if (data.success && data.tree) {\n            data.tree.roots = (data.tree.roots || []).map((root, idx) => ({\n                ...root,\n                conversation_number: idx + 1\n            }));\n            conversationTrees[pageid] = data.tree;\n            sidebar.data('sidebar-view', 'list');\n            renderConversationListSimple(pageid, data.tree.roots);\n            // Note: updateMessageTurnLabels is for turns mode only, not needed for continuous\n            return data.tree;\n        } else {\n            treeContainer.html('<div class=\"text-muted text-center small py-3\">' +\n                (data.message || 'No conversation tree available yet.') + '</div>');\n            return null;\n        }\n    })\n    .catch((error) => {\n        // eslint-disable-next-line no-console\n        console.error('Error loading conversation tree:', error);\n        treeContainer.html('<div class=\"text-danger text-center small py-3\">' +\n            'Error loading conversation tree: ' + error.message + '<br>' +\n            'Please check the browser console for details and refresh the page.</div>');\n        return null;\n    });\n};\n\nconst navigateToConversation = (pageid, conversationId) => {\n    const container = $(`#chat-messages-page-${pageid}`).closest('.ai-conversation-container');\n    container.data('viewing-conversation', conversationId);\n    container.attr('data-viewing-conversation', conversationId);\n    filterMessagesByConversation(pageid, conversationId);\n    const sidebar = $(`#conversation-tree-sidebar-${pageid}`);\n    if (sidebar.length) {\n        sidebar.data('sidebar-view', 'list');\n        // Reload tree to update active state\n        loadConversationTree(pageid);\n    }\n};\n\nconst updateMessageTurnLabels = (pageid) => {\n    const messagesContainer = $(`#chat-messages-page-${pageid}`);\n    messagesContainer.find('.message').each(function() {\n        const $msg = $(this);\n        const turnId = parseInt($msg.data('turn-id'), 10);\n        if (turnId) {\n            const turnLabel = 'Turno ' + turnId;\n            const $badge = $msg.find('.badge').filter(function() {\n                return $(this).closest('.position-absolute').length > 0;\n            });\n            if ($badge.length > 0) {\n                $badge.text(turnLabel);\n            } else {\n                const $firstBadge = $msg.find('.badge').first();\n                if ($firstBadge.length > 0) {\n                    $firstBadge.text(turnLabel);\n                }\n            }\n        }\n    });\n};\n\nconst createNewRoot = (cmid, pageid) => {\n    const container = $(`.ai-conversation-container[data-pageid=\"${pageid}\"]`);\n    const messagesContainer = $(`#chat-messages-page-${pageid}`);\n    const params = new URLSearchParams();\n    params.append('action', 'create_root');\n    params.append('cmid', cmid);\n    params.append('pageid', pageid);\n    params.append('sesskey', Config.sesskey);\n    fetch(Config.wwwroot + '/mod/harpiasurvey/ajax.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: params.toString()\n    })\n    .then((response) => {\n        if (!response.ok) {\n            throw new Error('HTTP error! status: ' + response.status);\n        }\n        return response.json();\n    })\n    .then((data) => {\n        if (data.success) {\n            const newConversationId = parseInt(data.new_conversation_id || data.new_turn_id, 10);\n            container.data('viewing-conversation', newConversationId);\n            container.attr('data-viewing-conversation', newConversationId);\n            messagesContainer.html('<div class=\"text-muted text-center small py-3\">' +\n                'New conversation started. Send a message to begin.</div>');\n            const sidebar = $(`#conversation-tree-sidebar-${pageid}`);\n            sidebar.data('sidebar-view', 'list');\n            setTimeout(() => {\n                loadConversationTree(pageid).then((tree) => {\n                    if (tree && tree.roots) {\n                        const root = tree.roots.find(r =>\n                            parseInt((r.conversation_id || r.turn_id), 10) === newConversationId\n                        );\n                        if (root) {\n                            navigateToConversation(pageid, root.conversation_id || root.turn_id);\n                            return;\n                        }\n                    }\n                    const treeData = conversationTrees[pageid] || {roots: []};\n                    const nextNumber = (treeData.roots?.length || 0) + 1;\n                    const newRoot = {\n                        turn_id: newConversationId,\n                        conversation_id: newConversationId,\n                        is_root: true,\n                        children: [],\n                        parent_turn_id: null,\n                        branch_label: null,\n                        timecreated: Math.floor(Date.now() / 1000),\n                        timecreated_str: new Date().toLocaleString(),\n                        message_count: 1,\n                        conversation_number: nextNumber\n                    };\n                    treeData.roots = [...(treeData.roots || []), newRoot];\n                    conversationTrees[pageid] = treeData;\n                    renderConversationListSimple(pageid, treeData.roots);\n                    navigateToConversation(pageid, newConversationId);\n                });\n            }, 100);\n            Notification.addNotification({\n                message: data.message || 'New conversation created successfully',\n                type: 'success'\n            });\n        } else {\n            addError(data.message || 'Failed to create new root');\n        }\n    })\n    .catch((error) => {\n        // eslint-disable-next-line no-console\n        console.error('Error creating new root:', error);\n        addError('Error creating new root: ' + error.message);\n    });\n};\n"],"names":["initialized","commonHandlersRegistered","treeHandlersRegistered","initialize","containers","length","each","pageid","parseInt","this","data","initContinuousPage","document","on","e","preventDefault","button","cmid","input","inputValue","val","message","trim","modelsdata","closest","modelid","modelids","split","prop","tempId","Date","now","Math","random","toString","substr","displayUserMessage","loading","show","sendMessage","key","shiftKey","find","click","registerCommonHandlers","node","conversationId","attr","replace","navigateToConversation","item","sidebarId","createNewRoot","container","params","URLSearchParams","append","Config","sesskey","window","open","wwwroot","registerTreeHandlers","allMessages","lastMessage","last","lastMessageId","isNaN","rootId","currentId","found","parentMap","Map","msgId","parentId","set","get","filterMessagesByConversation","sidebar","loadConversationTree","messagesContainer","conversationMessageIds","Set","add","messageParentMap","messageId","changed","entries","has","hasVisibleMessages","hide","placeholder","prepend","setTimeout","viewingConversation","parentid","lastMessageInConversation","lastTimeCreated","timeCreated","action","fetch","method","headers","then","response","ok","Error","status","json","success","root_conversation_id","messageid","content","displayAIMessage","turn_id","focus","catch","error","console","remove","render","id","timecreated","floor","html","Notification","exception","Promise","resolve","Templates","renderConversationListSimple","roots","treeContainer","forEach","root","conversationNumber","conversation_number","conversation_id","isActive","message_count","body","tree","map","idx","newConversationId","new_conversation_id","new_turn_id","r","treeData","conversationTrees","nextNumber","newRoot","is_root","children","parent_turn_id","branch_label","timecreated_str","toLocaleString","addNotification","type"],"mappings":"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"}