{"version":3,"file":"fancytree_loader.min.js","sources":["../src/fancytree_loader.js"],"sourcesContent":["// Lazy loader for Fancytree assets (JS + CSS) for the turns sidebar.\nimport $ from 'jquery';\nimport Config from 'core/config';\n\nlet loadPromise = null;\n\nconst injectCssOnce = () => {\n    const href = Config.wwwroot + '/mod/harpiasurvey/amd/vendor/fancytree/skin-win8.min.css';\n    if (document.querySelector(`link[data-fancytree-css=\"${href}\"]`)) {\n        return;\n    }\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = href;\n    link.dataset.fancytreeCss = href;\n    document.head.appendChild(link);\n};\n\n/**\n * Load Fancytree JS (all deps bundle) and CSS. Returns a promise that resolves to $.ui.fancytree.\n *\n * @return {Promise} Resolves when Fancytree is available\n */\nexport const ensureFancytree = () => {\n    if (loadPromise) {\n        return loadPromise;\n    }\n\n    injectCssOnce();\n\n    loadPromise = new Promise((resolve, reject) => {\n        if ($.ui && $.ui.fancytree) {\n            resolve($.ui.fancytree);\n            return;\n        }\n\n        // Temporarily disable AMD define to avoid mismatched anonymous define errors\n        // when loading the UMD bundle directly.\n        const previousDefine = window.define;\n        window.define = undefined;\n\n        const script = document.createElement('script');\n        // all-deps bundle includes the minimal jQuery UI pieces Fancytree needs.\n        script.src = Config.wwwroot + '/mod/harpiasurvey/amd/vendor/fancytree/jquery.fancytree.min.js';\n        script.async = true;\n        script.onload = () => {\n            window.define = previousDefine;\n            if ($.ui && $.ui.fancytree) {\n                resolve($.ui.fancytree);\n            } else {\n                reject(new Error('Fancytree failed to load'));\n            }\n        };\n        script.onerror = () => {\n            window.define = previousDefine;\n            reject(new Error('Failed to load Fancytree script'));\n        };\n        document.head.appendChild(script);\n    });\n\n    return loadPromise;\n};\n\nexport default {\n    ensureFancytree\n};\n"],"names":["loadPromise","ensureFancytree","href","Config","wwwroot","document","querySelector","link","createElement","rel","dataset","fancytreeCss","head","appendChild","injectCssOnce","Promise","resolve","reject","$","ui","fancytree","previousDefine","window","define","undefined","script","src","async","onload","Error","onerror"],"mappings":"iYAIIA,YAAc,WAmBLC,gBAAkB,IACvBD,cAlBc,YACZE,KAAOC,gBAAOC,QAAU,8DAC1BC,SAASC,cAAe,4BAA2BJ,uBAGjDK,KAAOF,SAASG,cAAc,QACpCD,KAAKE,IAAM,aACXF,KAAKL,KAAOA,KACZK,KAAKG,QAAQC,aAAeT,KAC5BG,SAASO,KAAKC,YAAYN,OAa1BO,GAEAd,YAAc,IAAIe,SAAQ,CAACC,QAASC,aAC5BC,gBAAEC,IAAMD,gBAAEC,GAAGC,sBACbJ,QAAQE,gBAAEC,GAAGC,iBAMXC,eAAiBC,OAAOC,OAC9BD,OAAOC,YAASC,QAEVC,OAASpB,SAASG,cAAc,UAEtCiB,OAAOC,IAAMvB,gBAAOC,QAAU,iEAC9BqB,OAAOE,OAAQ,EACfF,OAAOG,OAAS,KACZN,OAAOC,OAASF,eACZH,gBAAEC,IAAMD,gBAAEC,GAAGC,UACbJ,QAAQE,gBAAEC,GAAGC,WAEbH,OAAO,IAAIY,MAAM,8BAGzBJ,OAAOK,QAAU,KACbR,OAAOC,OAASF,eAChBJ,OAAO,IAAIY,MAAM,qCAErBxB,SAASO,KAAKC,YAAYY,WAGvBzB,mEAGI,CACXC,gBAAAA"}