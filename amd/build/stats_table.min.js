/**
 * Stats table functionality for expanding/collapsing long answers.
 *
 * @module     mod_harpiasurvey/stats_table
 * @copyright  2025 Your Name
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_harpiasurvey/stats_table",["jquery"],(function($){function renderAnswerItems(answerItems){let html="";return answerItems.forEach((function(item){item.isoption?(html+='<span class="badge badge-secondary answer-tag mr-1 mb-1">',html+='<span class="answer-text">'+$("<div>").text(item.text).html()+"</span>",html+="</span>"):html+='<span class="answer-text-plain">'+$("<div>").text(item.text).html()+"</span>"})),html}return{init:function(){$(document).on("click",".expand-conversation-btn",(function(){const button=$(this),conversationId=button.data("conversation-id"),messagesDiv=$('.conversation-messages[data-conversation-id="'+conversationId+'"]'),expandText=button.find(".expand-text"),collapseText=button.find(".collapse-text");messagesDiv.is(":visible")?(messagesDiv.slideUp(),expandText.show(),collapseText.hide()):(messagesDiv.slideDown(),expandText.hide(),collapseText.show())})),$(document).on("click",".expand-answer-btn",(function(){const button=$(this),responseId=button.data("response-id"),answerContainer=$('.answer-container[data-response-id="'+responseId+'"]'),answerItemsDiv=answerContainer.find(".answer-items"),expandText=button.find(".expand-text"),collapseText=button.find(".collapse-text"),answerItemsJson=answerContainer.data("answer-items");if(!answerItemsJson)return;let answerItems;try{answerItems=JSON.parse(answerItemsJson)}catch(e){return void console.error("Error parsing answer items:",e)}if(answerContainer.data("expanded")){let displayItems=[],totalLength=0;for(let i=0;i<answerItems.length;i++){const item=answerItems[i],itemText=item.text||"";if(totalLength+itemText.length>100&&i>0)break;if(itemText.length>100){displayItems.push({text:itemText.substring(0,100)+"...",number:item.number,isoption:item.isoption});break}displayItems.push(item),totalLength+=itemText.length}answerItemsDiv.html(renderAnswerItems(displayItems)),answerContainer.data("expanded",!1),expandText.show(),collapseText.hide()}else answerItemsDiv.html(renderAnswerItems(answerItems)),answerContainer.data("expanded",!0),expandText.hide(),collapseText.show()})),$(document).on("click",".view-eval-messages-btn",(function(){const messagesJson=$(this).attr("data-messages");let messages=[];if(messagesJson)try{messages=JSON.parse(messagesJson)}catch(e){console.error("Error parsing messages JSON:",e)}const modalBody=$("#harpiasurvey-messages-modal-body");if(0===messages.length)modalBody.html('<div class="text-muted text-center py-3">No messages yet.</div>');else{let html='<div class="border rounded p-3" style="background-color: #f8f9fa; max-height: 60vh; overflow-y: auto;">';messages.forEach((function(msg){const time=msg.timecreated||"",model=msg.modelname?' <small class="text-muted">('+$("<div>").text(msg.modelname).html()+")</small>":"";msg.role&&msg.role.user?(html+='<div class="message mb-3 text-right">',html+='<div class="d-inline-block p-2 rounded bg-primary text-white" style="max-width: 80%;">',html+='<div class="message-content">'+(msg.content||"")+"</div>",html+='<small class="text-white-50 d-block mt-1">'+$("<div>").text(time).html()+model+"</small>",html+="</div></div>"):msg.role&&msg.role.assistant&&(html+='<div class="message mb-3 text-left">',html+='<div class="d-inline-block p-2 rounded bg-light border" style="max-width: 80%;">',html+='<div class="message-content">'+(msg.content||"")+"</div>",html+='<small class="text-muted d-block mt-1">'+$("<div>").text(time).html()+model+"</small>",html+="</div></div>")})),html+="</div>",modalBody.html(html)}$("#harpiasurvey-messages-modal").modal("show")}))}}}));

//# sourceMappingURL=stats_table.min.js.map