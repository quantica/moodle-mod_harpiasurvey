define("mod_harpiasurvey/notification_modal",["exports","core/str","core/notification","jquery"],(function(_exports,_str,_notification,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=_interopRequireDefault(_notification),_jquery=_interopRequireDefault(_jquery);const MODAL_ID="harpiasurvey-notification-modal";let cachedStrings=null,observerStarted=!1,notificationPatched=!1;const getStrings=()=>cachedStrings?Promise.resolve(cachedStrings):Promise.all([(0,_str.get_string)("notifications","mod_harpiasurvey").catch((()=>"Notifications")),(0,_str.get_string)("close","moodle").catch((()=>"Close")),(0,_str.get_string)("success","moodle").catch((()=>"Success")),(0,_str.get_string)("error","moodle").catch((()=>"Error")),(0,_str.get_string)("warning","moodle").catch((()=>"Warning")),(0,_str.get_string)("info","moodle").catch((()=>"Info"))]).then((strings=>(cachedStrings={title:strings[0],closeLabel:strings[1],labels:{success:strings[2],danger:strings[3],warning:strings[4],info:strings[5]}},cachedStrings))),collectAlerts=root=>root.find(".alert").filter((function(){const el=(0,_jquery.default)(this);return el.text().trim().length>0&&!el.attr("data-harpia-notification-handled")})),showItemsInModal=items=>{items&&items.length&&getStrings().then((strings=>{const normalized=items.map((item=>{const type=item.type||"info";return{type:type,label:strings.labels[type]||strings.labels.info,html:item.html||""}})).filter((item=>""!==item.html.trim()));if(!normalized.length)return;const existing=(0,_jquery.default)(`#${MODAL_ID}`);existing.length&&existing.remove(),(0,_jquery.default)("body").append(((title,closeLabel,items)=>{const bodyItems=items.map((item=>{const badgeClass="danger"===item.type?"danger":"success"===item.type?"success":"warning"===item.type?"warning":"info";return`\n            <div class="alert alert-${item.type} mb-2" role="alert">\n                <span class="badge badge-${badgeClass} mr-2">${item.label}</span>\n                <span>${item.html}</span>\n            </div>\n        `})).join("");return`\n        <div class="modal fade" id="${MODAL_ID}" tabindex="-1" aria-hidden="true">\n            <div class="modal-dialog modal-dialog-centered">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title">${title}</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="${closeLabel}"></button>\n                    </div>\n                    <div class="modal-body">\n                        ${bodyItems}\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">${closeLabel}</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `})(strings.title,strings.closeLabel,normalized));const root=(0,_jquery.default)("#user-notifications");root.length&&root.hide();const modalElement=document.getElementById(MODAL_ID);if(!modalElement)return;new window.bootstrap.Modal(modalElement).show()}))},showAlertsInModal=root=>{const notices=collectAlerts(root);notices.length&&getStrings().then((strings=>{const items=[];notices.each((function(){const el=(0,_jquery.default)(this),type=(node=>{const el=(0,_jquery.default)(node);return el.hasClass("alert-danger")||el.hasClass("alert-error")?"danger":el.hasClass("alert-success")?"success":el.hasClass("alert-warning")?"warning":"info"})(this);items.push({type:type,label:strings.labels[type]||strings.labels.info,html:el.html()}),el.attr("data-harpia-notification-handled","1"),el.remove()})),items.length&&showItemsInModal(items)}))};_exports.init=()=>{if(!window.bootstrap||!window.bootstrap.Modal)return;const root=(0,_jquery.default)("#user-notifications");root.length&&(showAlertsInModal(root),(root=>{if(observerStarted)return;observerStarted=!0;const observer=new MutationObserver((()=>{showAlertsInModal(root)}));root.length&&root[0]&&observer.observe(root[0],{childList:!0,subtree:!0})})(root),(()=>{if(notificationPatched||!_notification.default||"function"!=typeof _notification.default.addNotification)return;const originalAddNotification=_notification.default.addNotification.bind(_notification.default);_notification.default.addNotification=function(){let data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const message=data.message,html=Array.isArray(message)?message.join("<br>"):String(message||"");return html.trim()?(showItemsInModal([{type:data.type||"info",html:html}]),Promise.resolve()):originalAddNotification(data)},notificationPatched=!0})())}}));

//# sourceMappingURL=notification_modal.min.js.map