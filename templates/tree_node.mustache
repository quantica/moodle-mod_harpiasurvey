{{!
    This file is part of Moodle - https://moodle.org/
    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <https://www.gnu.org/licenses/>.
}}
{{!
    @template mod_harpiasurvey/tree_node

    Template for a single node in the conversation tree.

    Context variables required for this template:
    * turn_id - Turn ID
    * is_root - Whether this is a root node
    * is_current - Whether this is the currently active turn
    * has_children - Whether this node has children
    * branch_label - Optional label for this branch
    * level - Nesting level (0 for root)
    * children - Array of child nodes (recursive)

    Example context (json):
    {
        "turn_id": 1,
        "is_root": true,
        "is_current": false,
        "has_children": true,
        "branch_label": null,
        "level": 0,
        "children": []
    }
}}
<div class="tree-node mb-2" data-turn-id="{{turn_id}}" {{#conversation_id}}data-conversation-id="{{conversation_id}}"{{/conversation_id}} data-level="{{level}}" data-is-root="{{is_root}}">
    <div class="d-flex align-items-center tree-node-content p-1 rounded {{#is_current}}bg-primary text-white shadow-sm{{/is_current}}{{^is_current}}border hover-shadow{{/is_current}}" 
         style="cursor: pointer; transition: all 0.2s; font-size: 0.875rem;"
         data-action="navigate" data-turn-id="{{turn_id}}" {{#conversation_id}}data-conversation-id="{{conversation_id}}"{{/conversation_id}}
         onmouseover="this.style.backgroundColor='#0b3d91'; this.style.borderColor='#0b3d91'; this.style.color='#fff';"
         onmouseout="{{#is_current}}this.style.backgroundColor='#007bff'; this.style.borderColor='#007bff'; this.style.color='#fff';{{/is_current}}{{^is_current}}this.style.backgroundColor=''; this.style.borderColor=''; this.style.color='';{{/is_current}}">
        <i class="fa fa-{{#is_root}}{{#is_direct_branch}}code-branch{{/is_direct_branch}}{{^is_direct_branch}}comments{{/is_direct_branch}}{{/is_root}}{{^is_root}}code-branch{{/is_root}} mr-2 {{#is_current}}text-white{{/is_current}}{{^is_current}}text-primary{{/is_current}}" style="color: inherit;"></i>
        <span class="flex-grow-1 font-weight-{{#is_current}}bold{{/is_current}}{{^is_current}}normal{{/is_current}}" style="line-height: 1.2;">
            {{#str}}turn, mod_harpiasurvey{{/str}} {{#turn_number}}{{turn_number}}{{/turn_number}}{{^turn_number}}{{turn_id}}{{/turn_number}}
            {{#branch_label}}
                <small class="text-muted ml-1">({{branch_label}})</small>
            {{/branch_label}}
        </span>
        {{#is_current}}
            <span class="badge badge-light badge-sm ml-2" title="{{#str}}currentbranch, mod_harpiasurvey{{/str}}">
                <i class="fa fa-circle text-primary" aria-hidden="true" style="font-size: 0.5rem;"></i>
            </span>
        {{/is_current}}
        {{#has_children}}
            <button type="button" class="btn btn-xs btn-outline-success ml-2 create-branch-from-tree-btn" 
                    data-pageid="{{pageid}}" 
                    data-cmid="{{cmid}}" 
                    data-turn-id="{{turn_id}}"
                    data-branch-mode="enter"
                    data-toggle="popover"
                    data-trigger="hover"
                    data-placement="top"
                    data-content="{{#str}}viewbranches, mod_harpiasurvey{{/str}}"
                    aria-label="{{#str}}viewbranches, mod_harpiasurvey{{/str}}" style="padding: 0.1rem 0.4rem;">
                <span class="branch-label d-none d-sm-inline">{{#str}}viewbranches, mod_harpiasurvey{{/str}}</span>
            </button>
        {{/has_children}}
        {{^has_children}}
        {{#can_create_branch}}
            <button type="button" class="btn btn-xs btn-{{#is_current}}light{{/is_current}}{{^is_current}}outline-success{{/is_current}} ml-2 create-branch-from-tree-btn" 
                    data-pageid="{{pageid}}" 
                    data-cmid="{{cmid}}" 
                    data-turn-id="{{turn_id}}"
                    data-toggle="popover"
                    data-trigger="hover"
                    data-placement="top"
                    data-content="{{#str}}createbranch, mod_harpiasurvey{{/str}}"
                    aria-label="{{#str}}createbranch, mod_harpiasurvey{{/str}}" style="padding: 0.1rem 0.25rem;">
                <i class="fa fa-code-branch fa-xs" aria-hidden="true"></i>
            </button>
        {{/can_create_branch}}
        {{/has_children}}
    </div>
</div>
