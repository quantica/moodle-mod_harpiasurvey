{{!
    This file is part of Moodle - https://moodle.org/
    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <https://www.gnu.org/licenses/>.
}}
{{!
    @template mod_harpiasurvey/experiment_view

    Template for viewing an experiment with pages management.

    Context variables required for this template:
    * experimentname - The experiment name
    * pageslabel - Label for pages
    * questionsurl - URL to questions tab
    * pagesurl - URL to pages tab
    * questionslabel - Label for questions
    * pageslist - Array of pages
    * has_pages - Whether there are pages
    * nopages - No pages message
    * addpageurl - URL to add a page
    * addpagelabel - Label for add page button
    * selectpagetoadd - Message when no page selected
    * viewingpage - Whether viewing a page
    * editing - Whether editing
    * formhtml - Form HTML if editing
    * pageviewhtml - Page view HTML if viewing
    * backtocourseurl - URL to go back to course
    * backtocourselabel - Label for back button
    * current_tab - Current tab (pages or models)
    * modelshtml - Models view HTML
}}
<!-- Pages navigation bar (horizontal, below secondary navigation) - Tab style -->
{{#is_pages}}
<div class="pages-navigation-bar mb-3" data-navigation-mode="{{navigation_mode}}" data-canmanage="{{can_navigate}}">
    <div class="pages-tabs-container">
        <div class="d-flex align-items-center justify-content-between flex-wrap">
            <div class="pages-tabs-wrapper flex-grow-1 min-w-0">
                {{#has_pages}}
                    <ul class="nav nav-tabs pages-tabs" role="tablist">
                        {{#pageslist}}
                            <li class="nav-item pages-tab-item{{#is_disabled}} disabled{{/is_disabled}}" role="presentation">
                                {{#is_disabled}}
                                    <span class="nav-link pages-tab-link disabled{{#is_active}} active{{/is_active}}" 
                                          title="{{title}}"
                                          role="tab"
                                          aria-disabled="true">
                                        <span class="page-number">{{number}}</span>
                                        <span class="page-title">{{title}}</span>
                                    </span>
                                {{/is_disabled}}
                                {{^is_disabled}}
                                <a href="{{url}}" 
                                       class="nav-link pages-tab-link page-tab-link{{#is_active}} active{{/is_active}}"
                                   title="{{title}}"
                                       role="tab"
                                       data-pageid="{{id}}">
                                    <span class="page-number">{{number}}</span>
                                    <span class="page-title">{{title}}</span>
                                </a>
                                {{/is_disabled}}
                            </li>
                        {{/pageslist}}
                    </ul>
                {{/has_pages}}
                {{^has_pages}}
                    <div class="text-muted small py-2">{{nopages}}</div>
                {{/has_pages}}
            </div>
            {{#editingmode}}
            {{#canmanage}}
                <div class="ml-2 mt-2 mt-md-0">
                    <a href="{{addpageurl}}" class="btn btn-primary btn-sm add-page-btn">
                        <i class="fa fa-plus" aria-hidden="true"></i> <span class="add-page-text">{{addpagelabel}}</span>
                    </a>
                </div>
            {{/canmanage}}
            {{/editingmode}}
        </div>
    </div>
</div>
{{/is_pages}}

<!-- Main content area (full width now) -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                {{#is_models}}
                    <!-- Models tab content -->
                    {{{modelshtml}}}
                {{/is_models}}
                {{^is_models}}
                    {{#editing}}
                        <!-- Editing mode: show form -->
                        <h4>{{#str}}general, form{{/str}}</h4>
                        {{{formhtml}}}
                    {{/editing}}
                    {{^editing}}
                        {{#viewingpage}}
                            <!-- Viewing mode: show rendered page -->
                            {{{pageviewhtml}}}
                        {{/viewingpage}}
                        {{^viewingpage}}
                            <!-- No page selected -->
                            <p class="text-muted">{{selectpagetoadd}}</p>
                        {{/viewingpage}}
                    {{/editing}}
                {{/is_models}}
            </div>
        </div>
    </div>
</div>

<!-- Back to course button -->
<div class="mt-3">
    <a href="{{backtocourseurl}}" class="btn btn-secondary">{{backtocourselabel}}</a>
</div>
