<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="mod/harpiasurvey/db" VERSION="20250107" COMMENT="XMLDB file for Moodle mod_harpiasurvey"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd"
>
  <TABLES>
    <TABLE NAME="harpiasurvey" COMMENT="Stores the harpiasurvey activity module instances.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="course" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the course this activity is part of."/>
        <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="The name of the activity module instance"/>
        <FIELD NAME="intro" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Activity description."/>
        <FIELD NAME="introformat" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="The format of the intro field."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the instance was added to the course."/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the instance was last modified."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_course" TYPE="foreign" FIELDS="course" REFTABLE="course" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="harpiasurvey_models" COMMENT="Stores LLM models that can be used in experiments.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="harpiasurveyid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the harpiasurvey instance this model belongs to."/>
        <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Display name of the LLM model (e.g., OpenAI GPT 4o)."/>
        <FIELD NAME="model" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Model identifier (e.g., gpt-4o-2025712)."/>
        <FIELD NAME="provider" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="Provider identifier (openai, azure_openai, anthropic, gemini, openrouter, ollama, custom)."/>
        <FIELD NAME="description" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Description of the model."/>
        <FIELD NAME="apikey" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="API key or identifier for the model."/>
        <FIELD NAME="endpoint" TYPE="char" LENGTH="500" NOTNULL="false" SEQUENCE="false" COMMENT="API endpoint URL for the model."/>
        <FIELD NAME="azure_resource" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Azure OpenAI resource name."/>
        <FIELD NAME="azure_deployment" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Azure OpenAI deployment name."/>
        <FIELD NAME="azure_api_version" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="Azure OpenAI API version."/>
        <FIELD NAME="anthropic_version" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="Anthropic API version header value."/>
        <FIELD NAME="customheaders" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Custom request headers as JSON."/>
        <FIELD NAME="responsepath" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Dot path to extract response content."/>
        <FIELD NAME="extrafields" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Extra parameters as JSON string."/>
        <FIELD NAME="systemprompt" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Optional system role prompt prepended to conversations."/>
        <FIELD NAME="enabled" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether the model is enabled (0 = disabled, 1 = enabled)."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the model was created."/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the model was last modified."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_harpiasurvey" TYPE="foreign" FIELDS="harpiasurveyid" REFTABLE="harpiasurvey" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="harpiasurvey_experiments" COMMENT="Stores experiments within a harpiasurvey instance.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="harpiasurveyid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the harpiasurvey instance this experiment belongs to."/>
        <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Name of the experiment."/>
        <FIELD NAME="description" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Description of the experiment."/>
        <FIELD NAME="descriptionformat" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Format of the description field."/>
        <FIELD NAME="createdby" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="User ID of the experiment creator."/>
        <FIELD NAME="participants" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Number of participants in the experiment."/>
        <FIELD NAME="maxparticipants" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Maximum number of participants allowed (null = unlimited)."/>
        <FIELD NAME="availability" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Availability start timestamp (0 = always available)."/>
        <FIELD NAME="availabilityend" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Availability end timestamp (0 = no end)."/>
        <FIELD NAME="hascrossvalidation" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Whether the experiment has cross-validation (0 = no, 1 = yes)."/>
        <FIELD NAME="published" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Whether the experiment is published (0 = draft, 1 = published)."/>
        <FIELD NAME="status" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="draft" SEQUENCE="false" COMMENT="Status: draft, running, finished."/>
        <FIELD NAME="navigation_mode" TYPE="char" LENGTH="50" NOTNULL="false" DEFAULT="free_navigation" SEQUENCE="false" COMMENT="Navigation flow mode: free_navigation (can go back/forward) or only_forward (can only go forward, must answer all questions)."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the experiment was created."/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the experiment was last modified."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_harpiasurvey" TYPE="foreign" FIELDS="harpiasurveyid" REFTABLE="harpiasurvey" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="harpiasurvey_experiment_models" COMMENT="Many-to-many relationship between experiments and LLM models.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="experimentid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the experiment."/>
        <FIELD NAME="modelid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the LLM model."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the association was created."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_experiment" TYPE="foreign" FIELDS="experimentid" REFTABLE="harpiasurvey_experiments" REFFIELDS="id"/>
        <KEY NAME="fk_model" TYPE="foreign" FIELDS="modelid" REFTABLE="harpiasurvey_models" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="unique_experiment_model" UNIQUE="true" FIELDS="experimentid, modelid" COMMENT="Ensure each experiment-model pair is unique."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_page_models" COMMENT="Many-to-many relationship between pages and LLM models.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the page."/>
        <FIELD NAME="modelid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the LLM model."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the association was created."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_page" TYPE="foreign" FIELDS="pageid" REFTABLE="harpiasurvey_pages" REFFIELDS="id"/>
        <KEY NAME="fk_model" TYPE="foreign" FIELDS="modelid" REFTABLE="harpiasurvey_models" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="unique_page_model" UNIQUE="true" FIELDS="pageid, modelid" COMMENT="Ensure each page-model pair is unique."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_pages" COMMENT="Stores internal pages within an experiment.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="experimentid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the experiment this page belongs to."/>
        <FIELD NAME="title" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Title of the page."/>
        <FIELD NAME="description" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Description/content of the page."/>
        <FIELD NAME="descriptionformat" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Format of the description field."/>
        <FIELD NAME="type" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="Type of page (opening, demographic, interaction, feedback, aichat)."/>
        <FIELD NAME="behavior" TYPE="char" LENGTH="50" NOTNULL="false" DEFAULT="continuous" SEQUENCE="false" COMMENT="Behavior mode: continuous (default), turns (turn-based navigation), multi_model (future)."/>
        <FIELD NAME="min_turns" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Minimum number of turns required (NULL = no minimum, only for turns behavior)."/>
        <FIELD NAME="max_turns" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Maximum number of turns allowed (NULL = no maximum, only for turns behavior)."/>
        <FIELD NAME="available" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether the page is available (0 = disabled, 1 = enabled)."/>
        <FIELD NAME="sortorder" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Sort order for displaying pages."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the page was created."/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the page was last modified."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_experiment" TYPE="foreign" FIELDS="experimentid" REFTABLE="harpiasurvey_experiments" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="harpiasurvey_subpages" COMMENT="Stores subpages within a parent page (only for aichat pages with turns mode).">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the parent page."/>
        <FIELD NAME="title" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Title of the subpage."/>
        <FIELD NAME="description" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Description/content of the subpage."/>
        <FIELD NAME="descriptionformat" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Format of the description field."/>
        <FIELD NAME="turn_visibility_type" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="all_turns" SEQUENCE="false" COMMENT="Visibility type: first_turn, specific_turn, all_turns."/>
        <FIELD NAME="turn_number" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Turn number for specific_turn visibility (NULL for other types)."/>
        <FIELD NAME="available" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether the subpage is available (0 = disabled, 1 = enabled)."/>
        <FIELD NAME="sortorder" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Sort order for displaying subpages."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the subpage was created."/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the subpage was last modified."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_page" TYPE="foreign" FIELDS="pageid" REFTABLE="harpiasurvey_pages" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_page_sortorder" UNIQUE="false" FIELDS="pageid, sortorder" COMMENT="Index for ordering subpages within a page."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_subpage_questions" COMMENT="Many-to-many relationship between subpages and questions.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="subpageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the subpage."/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the question."/>
        <FIELD NAME="enabled" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether the question is enabled on this subpage (0 = disabled, 1 = enabled)."/>
        <FIELD NAME="required" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether the question is required before navigating (0 = optional, 1 = required)."/>
        <FIELD NAME="turn_visibility_type" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="all_turns" SEQUENCE="false" COMMENT="Visibility type: first_turn, specific_turn, all_turns."/>
        <FIELD NAME="turn_number" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Turn number for specific_turn visibility (NULL for other types)."/>
        <FIELD NAME="sortorder" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Sort order for displaying questions on the subpage."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the association was created."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_subpage" TYPE="foreign" FIELDS="subpageid" REFTABLE="harpiasurvey_subpages" REFFIELDS="id"/>
        <KEY NAME="fk_question" TYPE="foreign" FIELDS="questionid" REFTABLE="harpiasurvey_questions" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="unique_subpage_question" UNIQUE="true" FIELDS="subpageid, questionid" COMMENT="Ensure each subpage-question pair is unique."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_questions" COMMENT="Stores questions that can be reused across experiments.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="harpiasurveyid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the harpiasurvey instance this question belongs to."/>
        <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Question name/identifier."/>
        <FIELD NAME="shortname" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="Short name/code for the question."/>
        <FIELD NAME="description" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Question text/description."/>
        <FIELD NAME="descriptionformat" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Format of the description field."/>
        <FIELD NAME="type" TYPE="char" LENGTH="50" NOTNULL="true" SEQUENCE="false" COMMENT="Question type (singlechoice, multiplechoice, select, likert, number, shorttext, longtext)."/>
        <FIELD NAME="settings" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON string storing type-specific settings (number settings, AI settings, etc.)."/>
        <FIELD NAME="enabled" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether the question is enabled (0 = disabled, 1 = enabled)."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the question was created."/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the question was last modified."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_harpiasurvey" TYPE="foreign" FIELDS="harpiasurveyid" REFTABLE="harpiasurvey" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="harpiasurvey_question_options" COMMENT="Stores options for single/multiple choice questions.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the question this option belongs to."/>
        <FIELD NAME="value" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Option value/text."/>
        <FIELD NAME="isdefault" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Whether this is the default option (0 = no, 1 = yes)."/>
        <FIELD NAME="sortorder" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Sort order for displaying options."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the option was created."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_question" TYPE="foreign" FIELDS="questionid" REFTABLE="harpiasurvey_questions" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="harpiasurvey_page_questions" COMMENT="Many-to-many relationship between pages and questions.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the page."/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the question."/>
        <FIELD NAME="enabled" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether the question is enabled on this page (0 = disabled, 1 = enabled)."/>
        <FIELD NAME="required" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="Whether the question is required before navigating (0 = optional, 1 = required)."/>
        <FIELD NAME="sortorder" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Sort order for displaying questions on the page."/>
        <FIELD NAME="min_turn" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Minimum turn number for this question to appear (NULL or 1 = appears from first turn, 2 = from second turn, etc.). Only used for aichat pages with turns mode."/>
        <FIELD NAME="show_only_turn" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Show question only on this specific turn number (NULL = show on all turns, N = show only on turn N). Only used for aichat pages with turns mode."/>
        <FIELD NAME="hide_on_turn" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Hide question on this specific turn number (NULL = no hiding, N = hide on turn N). Only used for aichat pages with turns mode."/>
        <FIELD NAME="show_only_model" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Show question only for this specific model ID (NULL = show for all models, N = show only for model N). Only used for aichat pages with multi-model mode."/>
        <FIELD NAME="hide_on_model" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Hide question for this specific model ID (NULL = no hiding, N = hide for model N). Only used for aichat pages with multi-model mode."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the association was created."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_page" TYPE="foreign" FIELDS="pageid" REFTABLE="harpiasurvey_pages" REFFIELDS="id"/>
        <KEY NAME="fk_question" TYPE="foreign" FIELDS="questionid" REFTABLE="harpiasurvey_questions" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="unique_page_question" UNIQUE="true" FIELDS="pageid, questionid" COMMENT="Ensure each page-question pair is unique."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_responses" COMMENT="Stores user responses to questions on pages.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the page."/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the question."/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the user who responded."/>
        <FIELD NAME="response" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="The response value (can be JSON for multiple choice)."/>
        <FIELD NAME="turn_id" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="ID of the turn this response evaluates (NULL for regular page questions, set for turn evaluation questions)."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the response was created."/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the response was last modified."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_page" TYPE="foreign" FIELDS="pageid" REFTABLE="harpiasurvey_pages" REFFIELDS="id"/>
        <KEY NAME="fk_question" TYPE="foreign" FIELDS="questionid" REFTABLE="harpiasurvey_questions" REFFIELDS="id"/>
        <KEY NAME="fk_user" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="unique_user_page_question" UNIQUE="true" FIELDS="userid, pageid, questionid, turn_id" COMMENT="Ensure each user can only have one response per question per page per turn."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_response_history" COMMENT="Stores save history for question responses.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="responseid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="ID of the response record (if available)."/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the page."/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the question."/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the user who saved the response."/>
        <FIELD NAME="response" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Saved response value (can be JSON for multiple choice)."/>
        <FIELD NAME="turn_id" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Turn ID for turn evaluation responses (NULL for regular questions)."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when this response was saved."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_page" TYPE="foreign" FIELDS="pageid" REFTABLE="harpiasurvey_pages" REFFIELDS="id"/>
        <KEY NAME="fk_question" TYPE="foreign" FIELDS="questionid" REFTABLE="harpiasurvey_questions" REFFIELDS="id"/>
        <KEY NAME="fk_user" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="fk_response" TYPE="foreign" FIELDS="responseid" REFTABLE="harpiasurvey_responses" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_page_user_question_turn" UNIQUE="false" FIELDS="pageid, userid, questionid, turn_id"/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_conversations" COMMENT="Stores conversation messages for AI conversation questions.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the page."/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="ID of the question (NULL for page-level conversations, set for question-specific conversations)."/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the user who sent/received the message."/>
        <FIELD NAME="modelid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the LLM model used for this message."/>
        <FIELD NAME="role" TYPE="char" LENGTH="20" NOTNULL="true" SEQUENCE="false" COMMENT="Message role: user or assistant."/>
        <FIELD NAME="content" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="Message content."/>
        <FIELD NAME="parentid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="ID of the parent message (for threading)."/>
        <FIELD NAME="turn_id" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="ID of the turn this message belongs to (NULL for continuous mode, set for turns mode)."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the message was created."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_page" TYPE="foreign" FIELDS="pageid" REFTABLE="harpiasurvey_pages" REFFIELDS="id"/>
        <KEY NAME="fk_user" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="fk_model" TYPE="foreign" FIELDS="modelid" REFTABLE="harpiasurvey_models" REFFIELDS="id"/>
        <KEY NAME="fk_parent" TYPE="foreign" FIELDS="parentid" REFTABLE="harpiasurvey_conversations" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_user_page" UNIQUE="false" FIELDS="userid, pageid" COMMENT="Index for loading conversation history by page."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_turn_evaluations" COMMENT="Stores user evaluations of AI responses in turns mode.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the page."/>
        <FIELD NAME="turn_id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the turn being evaluated."/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the user who evaluated."/>
        <FIELD NAME="rating" TYPE="int" LENGTH="1" NOTNULL="false" SEQUENCE="false" COMMENT="Rating value (1-5 or NULL if not rated)."/>
        <FIELD NAME="comment" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Optional comment about the turn."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the evaluation was created."/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the evaluation was last modified."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_page" TYPE="foreign" FIELDS="pageid" REFTABLE="harpiasurvey_pages" REFFIELDS="id"/>
        <KEY NAME="fk_user" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="unique_user_turn" UNIQUE="true" FIELDS="userid, pageid, turn_id" COMMENT="Ensure each user can only evaluate each turn once."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="harpiasurvey_turn_branches" COMMENT="Stores the tree structure of conversation turns, allowing branches from a single turn.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the page."/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the user who owns this conversation branch."/>
        <FIELD NAME="parent_turn_id" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="ID of the parent turn (NULL for root turn)."/>
        <FIELD NAME="child_turn_id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the child turn (the branch)."/>
        <FIELD NAME="branch_label" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Optional label/description for this branch (e.g., 'Path A', 'Response 1')."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Timestamp of when the branch was created."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_page" TYPE="foreign" FIELDS="pageid" REFTABLE="harpiasurvey_pages" REFFIELDS="id"/>
        <KEY NAME="fk_user" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_user_page_parent" UNIQUE="false" FIELDS="userid, pageid, parent_turn_id" COMMENT="Index for finding all branches from a parent turn."/>
        <INDEX NAME="unique_user_turn_branch" UNIQUE="true" FIELDS="userid, pageid, child_turn_id" COMMENT="Ensure each turn can only have one parent branch relationship."/>
      </INDEXES>
    </TABLE>
  </TABLES>
</XMLDB>
